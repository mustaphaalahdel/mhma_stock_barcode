[English](README.md)

# MHMA Stock Barcode (`mhma_stock_barcode`)

تطبيق باركود مخصص لأودو 17 يركز على **جرد المخزون (Inventory Adjustment)** بشكل مباشر، بحيث يعرض للمستخدم فقط **الأصناف/السطور (stock.quant) التي تم إسنادها له** لجردها.

التطبيق يعمل بواجهة Fullscreen مناسبة للموبايل ومشابهة لفكرة `stock_barcode`، لكن باختصار:
> “افتح التطبيق → شاهد مهام الجرد الخاصة بك فقط → عدّل الكميات بسرعة → احفظ/اطبع”.

> ملاحظة: هذا موديول مخصص، وتم تنسيق التوثيق بأسلوب قريب من توثيقات OCA.

## الفهرس
- [نبذة](#نبذة)
- [كيف يعمل التطبيق](#كيف-يعمل-التطبيق)
- [المميزات الرئيسية](#المميزات-الرئيسية)
- [الصلاحيات والوصول](#الصلاحيات-والوصول)
- [التثبيت](#التثبيت)
- [الإعدادات](#الإعدادات)
- [طريقة الاستخدام](#طريقة-الاستخدام)
- [التقارير](#التقارير)
- [ملاحظات تقنية](#ملاحظات-تقنية)
- [قيود معروفة](#قيود-معروفة)
- [تتبع الأخطاء](#تتبع-الأخطاء)
- [الشكر والاعتمادات](#الشكر-والاعتمادات)
- [الجهة المشرفة](#الجهة-المشرفة)
- [الرخصة](#الرخصة)

## نبذة
`mhma_stock_barcode` هو تطبيق مستقل (App) يفتح مباشرة على شاشة **Adjustment / Inventory Count** ويعرض فقط سطور الجرد الخاصة بالمستخدم الحالي.

مناسب للجهات التي:
- تقوم بإسناد الجرد لموظفين محددين.
- تريد أن يرى الموظف “الأصناف المطلوبة منه اليوم” فور فتح التطبيق.
- تحتاج واجهة واحدة فيها بحث + باركود + طباعة + حفظ.

## كيف يعمل التطبيق
عند فتح التطبيق يتم جلب بيانات `stock.quant` وفق فلترة أساسية:
- `user_id` = المستخدم الحالي
- مواقع التخزين من نوع **internal/transit**
- `inventory_date` أقل أو يساوي تاريخ اليوم

بالتالي كل مستخدم يرى فقط “مهام الجرد” المخصصة له والواجبة اليوم (أو قبل اليوم).

## المميزات الرئيسية
- **تطبيق جرد مستقل**
  - أيقونة التطبيق تفتح مباشرة شاشة الجرد (بدون قوائم إضافية).

- **التركيز على المهام المسندة للمستخدم**
  - يعرض فقط السطور المسندة للمستخدم الحالي لتقليل التشتيت.

- **شريط بحث علوي (ilike)**
  - شريط بحث ثابت أعلى الشاشة.
  - البحث يتم على `product.product.display_name` باستخدام `ilike` ثم يتم فلترة السطور داخل الواجهة.
  - عملي للبحث باسم المنتج، المرجع الداخلي، المتغيرات… وأي بيانات موجودة داخل `display_name`.

- **كل الأزرار المهمة في شريط سفلي واحد**
  - **Print**
  - **Barcode** (إدخال/مسح باركود يدوي)
  - **Save** مع عدّاد (كم سطر سيتم تطبيقه)

- **تعديل سريع للكميات**
  - زر تحديد/إلغاء تحديد السطر.
  - أزرار `+1 / -1` للتعديل السريع حسب الحالة.
  - زر تعديل (قلم) لفتح الفورم وإدخال الكمية عبر digipad.

- **التعامل مع الباركود و GS1**
  - يعتمد على Barcode Nomenclature الخاصة بالشركة ويدعم سلوك GS1 عند تفعيله.

- **التحكم في أصوات التنبيهات**
  - يدعم تفعيل/إيقاف أصوات التنبيه حسب الإعدادات.

## الصلاحيات والوصول
### المجموعات
- مجموعة **Adjustment Only**:
  - XML ID: `mhma_stock_barcode.adjustment_only_group`
  - الهدف منها: إعطاء موظف صلاحية الجرد فقط بدون صلاحيات مخزون كاملة.

### تحسين نطاق اختيار المستخدم في “طلب جرد”
الموديول يوسّع نطاق اختيار المستخدم داخل معالج **Request a Count** (`stock.request.count`) ليشمل:
- مستخدم مخزون (Inventory User) `stock.group_stock_user`
- أو مستخدم لديه مجموعة `adjustment_only_group`

## التثبيت
1. انسخ مجلد `mhma_stock_barcode` إلى مسار إضافات أودو.
2. أعد تشغيل السيرفر.
3. فعّل وضع المطور.
4. التطبيقات → تحديث قائمة التطبيقات.
5. ابحث عن **MHMA Stock Barcode** ثم ثبّت.

## الإعدادات
1. **منح الصلاحيات للمستخدمين**
   - إما إعطاء المستخدم **Inventory / User** (مستحسن)، أو
   - إعطاءه **Adjustment Only** (لجرد فقط)

2. **إسناد مهام الجرد من تطبيق المخزون**
   - استخدم سير عمل أودو الخاص بـ “Request a Count” (المعالج `stock.request.count`) لإسناد الجرد لمستخدم محدد.
   - مهم جدًا: اجعل `inventory_date` = اليوم أو قبل اليوم حتى تظهر المهام داخل تطبيق الباركود.

## طريقة الاستخدام
1. افتح تطبيق **MHMA Stock Barcode**.
2. سترى مباشرة الأصناف/السطور المسندة لك فقط.
3. استخدم:
   - البحث أعلى الشاشة لتصفية المنتجات
   - زر Barcode لمسح/إدخال باركود
   - زر القلم لتعديل سطر وإدخال الكمية
   - أزرار التحديد و `+1/-1` للتعديل السريع
4. اضغط **Save** لتطبيق السطور المعدّلة (حسب عدّاد الحفظ).
5. اطبع التقرير عند الحاجة.

## التقارير
- تقرير PDF بعنوان **Inventory Adjustment (Barcode)** متاح من زر Print.
- يحتوي على:
  - اسم الموظف (المستخدم الحالي)
  - التاريخ والوقت
  - السطور مجمعة حسب الموقع (عند تفعيل multi-location)
  - أعمدة الكميات + أعمدة التتبع/الحزم حسب الصلاحيات
  - مساحة توقيعات (Layout مخصص)

## ملاحظات تقنية
- التطبيق يعتمد على Client Action:
  - `mhma_stock_barcode.stock_barcode_inventory_client_action`
- تحميل بيانات الجرد يتم من `stock.quant._get_stock_barcode_data()` ويتم فيه فلترة:
  - `user_id = المستخدم الحالي`
  - مواقع `internal/transit`
  - `inventory_date <= اليوم`
- البحث:
  - يتم `searchRead` على `product.product` بالحقل `display_name ilike`
  - الحد الافتراضي للنتائج: 200
  - الفلترة تتم داخل الواجهة (لا تغيّر الدومين في السيرفر)

## قيود معروفة
- البحث محدود بـ 200 نتيجة لكل عملية بحث.
- السطور لا تظهر إلا إذا كان `inventory_date` موجودًا وأقل/يساوي تاريخ اليوم.
- في حال استخدام مجموعة “Adjustment Only”، تأكد أن بيئتك تمنح صلاحيات القراءة اللازمة للبيانات المرتبطة (المنتجات/المواقع/الوحدات/الدفعات…) حسب إعدادات الأمان لديك.

## تتبع الأخطاء
أبلغ عن المشاكل وطلبات التحسين عبر GitHub Issues داخل نفس المستودع.

## الشكر والاعتمادات
### المطور
- مصطفى الأحذل

## الجهة المشرفة
هذا الموديول تحت صيانة وإشراف **مصطفى الأحذل**.

## الرخصة
الرخصة معرّفة داخل `__manifest__.py` (حاليًا: `OEEL-1`).
تأكد من الامتثال لرخص Odoo قبل النشر العام.
